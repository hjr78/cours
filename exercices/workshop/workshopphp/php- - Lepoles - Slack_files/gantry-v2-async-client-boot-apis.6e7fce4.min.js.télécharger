(()=>{var ct=Object.defineProperty;var c=(K,p)=>ct(K,"name",{value:p,configurable:!0});(window.webpackJsonp=window.webpackJsonp||[]).push([["gantry-v2-async-client-boot-apis"],{CTVb:function(K,p,r){"use strict";r.r(p),r.d(p,"register",function(){return q}),r.d(p,"test",function(){return N});var u=r("9oTK"),b=r("ifKl"),C=r("Lgge"),W=r("Xm7Q"),v=r("s4P+"),R=r("cznn"),P=r("Ki/W");function E(t){if(!t)return{};const n=t.history.messages,a=t.channel||t.group||t.im,o=a==null?void 0:a.id,i=t.history.channel_actions_count,s=Number.isInteger(i)?{channelId:o,count:i}:null;return{channelData:a,messagesData:{msgs:n,channelId:o,latest:n.length>0?n[0].ts:null,oldest:n.length>0?n[n.length-1].ts:null,hasMore:{hasMoreEnd:!1,hasMoreStart:t.history.has_more},isLimited:t.history.is_limited},membersData:t.users,botsData:t.bots,channelActionsData:s,mutationTimestampsData:t.history.mutation_timestamps}}c(E,"processMessagesData");var y=r("Omjo"),U=r("Pw4T"),T=r("KGIc");function z(t){let{featureFlagConfigVersionTs:n,experimentsConfigVersionTs:a,teamId:o}=t;n||Object(U.a)().count("mvb_missing_feature_flag_config_version"),a||Object(U.a)().count("mvb_missing_experiment_config_version"),Object(y.b)("BOOT",`Feature flag config version: ${n}; Experiments config version: ${a}`),Object(T.i)(o,Math.min(a,n));const i=Object(T.c)();i?Object(y.b)("BOOT",`Current earliest config version: ${i}; All config versions: ${Object(T.a)()}`):Object(v.b)().warn("BOOT",`Missing config version: ${i}; All config versions: ${Object(T.a)()}`)}c(z,"storeConfigVersion");var j=r("heB0");function J(t){return O.apply(this,arguments)}c(J,"maybeFetchAllOnboardingData");function O(){return O=Object(u.coroutine)(function*(t){let{apiData:n,contextualInfo:a}=t;const o={onboardingData:null,labFeaturesStartupData:null},{featureFlagData:i}=n,s=n.clientBootData;if(!s||!i)return o;const{userPrefsData:f}=s,l=!!(i!=null&&i.feature_composer_email_classification);var D;if(!((D=window.location.search.match("skip_onboarding"))!==null&&D!==void 0?D:!1)&&f&&!f.onboarding_complete){var A;o.onboardingData=yield Object(j.k)(a),!((A=o.onboardingData)===null||A===void 0)&&A.setup_started||l&&(o.labFeaturesStartupData=yield Object(j.j)(a))}return o}),O.apply(this,arguments)}c(O,"_maybeFetchAllOnboardingData");function Y(t){let{viewData:n,channelsData:a=[]}=t;if(!(n!=null&&n.channelData))return a;const o=a.findIndex(i=>{var s;return i&&i.id===(n==null||(s=n.channelData)===null||s===void 0?void 0:s.id)});if(o!==-1){const i={...a[o],...n.channelData};a.splice(o,1,i)}return a}c(Y,"maybeMergeKnownChannelsData");var L=r("mard"),X=r("60mp");function Z(t){return F.apply(this,arguments)}c(Z,"maybeReloadForReAuth");function F(){return F=Object(u.coroutine)(function*(t){let{clientBootData:n}=t;if(!(n==null?void 0:n.should_reauth))return;Object(y.b)("BOOT","Detected need to reauth; fetching auth and halting current boot.");const o=!1,i=!1,s=[],f=!0;return Object(X.d)(o,i,s,f),Object(L.a)()}),F.apply(this,arguments)}c(F,"_maybeReloadForReAuth");var e=r("wwBm"),h=r("qiCS");function g(t){return d.apply(this,arguments)}c(g,"maybeRedirectToTermsOfService");function d(){return d=Object(u.coroutine)(function*(t){let{clientBootData:n}=t;const a=n.acceptTosUrl;if(!a)return;const o=Object(e.f)(location.search,"force_cold_boot",1),i=`/gantry${location.pathname}${o}`,s=Object(h.d)(a,"redirect",i);return Object(y.b)("BOOT",`(${n.teamData.id}) User needs to accept the terms of service; redirecting to ${s}`),location.assign(s),Object(L.a)()}),d.apply(this,arguments)}c(d,"_maybeRedirectToTermsOfService");var V=r("ycWl"),M=r("31wZ");function _(t){return m.apply(this,arguments)}c(_,"maybeReloadForMinVersionBump");function m(){return m=Object(u.coroutine)(function*(t){let{clientBootData:n}=t;const{should_reload:a,client_min_version:o}=n,i=Object(T.d)();if(parseInt(i??"0",10)&&a){if(Object(M.a)(o))return Object(V.a)({reason:"Reloading due to a min version bump (client.boot)",reasonKey:"min_version_bump_client_boot"}),Object(L.a)();throw new Error("Unable to reload for min version bump at boot")}}),m.apply(this,arguments)}c(m,"_maybeReloadForMinVersionBump");function B(t){return x.apply(this,arguments)}c(B,"transformInitialApiResponses");function x(){return x=Object(u.coroutine)(function*(t){let{apiCalls:n,contextualInfo:a}=t;const{clientBootData:o,viewData:i,...s}=n,f=n.clientBootData.then(P.a);f.catch(b.a);const l=n.viewData.then(E);return l.catch(b.a),{apiCalls:{clientBootData:f,viewData:l,...s},contextualInfo:a}}),x.apply(this,arguments)}c(x,"_transformInitialApiResponses");function H(t){return S.apply(this,arguments)}c(H,"setConfigVersions");function S(){return S=Object(u.coroutine)(function*(t){let{apiCalls:n,contextualInfo:a}=t;const{teamId:o}=a;if(!o)return{apiCalls:n,contextualInfo:a};const{featureFlagData:i,experimentData:s}=n;return C.a.all([i,s]).then(f=>{let[l,D]=f;const{config_version_ts:I}=l,{config_version_ts:A}=D;z({featureFlagConfigVersionTs:I,experimentsConfigVersionTs:A,teamId:o})},()=>{}).catch(f=>{Object(v.b)().error("BOOT",`Failed to store config version: ${f}`)}),{apiCalls:n,contextualInfo:a}}),S.apply(this,arguments)}c(S,"_setConfigVersions");function w(t){return $.apply(this,arguments)}c(w,"startOnboardingApis");function $(){return $=Object(u.coroutine)(function*(t){let{apiCalls:n,contextualInfo:a}=t;const{getTracer:o,getTrace:i}=a.getTraceMeta(),s=i(),f=C.a.all([n.clientBootData,n.featureFlagData]).then(l=>{let[D,I]=l;return o().traceFn({name:"fetchOnboardingData",options:{traceId:s.getTraceId(),parentSpanId:s.getRootSpanId()}},J.bind(null,{apiData:{clientBootData:D,featureFlagData:I},contextualInfo:a}))}).catch(l=>{throw l.type=W.a.API,l.subType="allOnboardingData",l});return f.catch(b.a),{apiCalls:{allOnboardingData:f,...n},contextualInfo:a}}),$.apply(this,arguments)}c($,"_startOnboardingApis");function k(t){return G.apply(this,arguments)}c(k,"maybeMergeChannelData");function G(){return G=Object(u.coroutine)(function*(t){let{apiCalls:n,contextualInfo:a}=t;const o=C.a.all([n.clientBootData,n.viewData]).then(i=>{let[s,f]=i;return{...s,channelsData:Y({viewData:f,channelsData:s.channelsData})}});return o.catch(b.a),{apiCalls:{...n,clientBootData:o},contextualInfo:a}}),G.apply(this,arguments)}c(G,"_maybeMergeChannelData");function q(t){t.hooks.apiAfterInitialCalls.tap("Transform initial API responses",B),t.hooks.apiAfterInitialCalls.tap("Maybe reload for a min version bump based on the client.boot response",function(){var n=Object(u.coroutine)(function*(a){let{apiCalls:o,contextualInfo:i}=a;const s=o.clientBootData.then(function(){var f=Object(u.coroutine)(function*(l){return yield _({clientBootData:l}),l});return function(l){return f.apply(this,arguments)}}());return s.catch(b.a),{apiCalls:{...o,clientBootData:s},contextualInfo:i}});return function(a){return n.apply(this,arguments)}}()),t.hooks.apiAfterInitialCalls.tap("Store config versions",H),t.hooks.apiAfterInitialCalls.tap("Start onboarding APIs",w),t.hooks.apiAfterInitialCalls.tap("Merge view data with client.boot channels data",k),t.hooks.apiAfterInitialCalls.tap("Close API Boot Queue",R.a),t.hooks.apiAfterInitialCalls.tap("Maybe re-auth based on the client.boot response",function(){var n=Object(u.coroutine)(function*(a){let{apiCalls:o,contextualInfo:i}=a;const s=o.clientBootData.then(function(){var f=Object(u.coroutine)(function*(l){return yield Z({clientBootData:l}),l});return function(l){return f.apply(this,arguments)}}());return s.catch(b.a),{apiCalls:{...o,clientBootData:s},contextualInfo:i}});return function(a){return n.apply(this,arguments)}}()),t.hooks.apiAfterInitialCalls.tap("Maybe redirect to the terms of service based on the client.boot response",function(){var n=Object(u.coroutine)(function*(a){let{apiCalls:o,contextualInfo:i}=a;const s=o.clientBootData.then(function(){var f=Object(u.coroutine)(function*(l){return yield g({clientBootData:l}),l});return function(l){return f.apply(this,arguments)}}());return s.catch(b.a),{apiCalls:{...o,clientBootData:s},contextualInfo:i}});return function(a){return n.apply(this,arguments)}}())}c(q,"register");const N={};Object.defineProperty(N,"transformInitialApiResponses",{get:()=>B,set:t=>{B=t}})},"Ki/W":function(K,p,r){"use strict";r.d(p,"a",function(){return j});var u=r("3Hq1"),b=r("owWc"),C=r("j77i"),W=r("dSGR"),v=r("T3x2"),R=r("YkFH"),P=r("1Np4"),E=r("hgl+");function y(e){return!!(e&&e.is_im)}c(y,"isIm");function U(e){return!!(e&&e.is_mpim)}c(U,"isMpim");function T(e){return y(e)&&e.user}c(T,"getMemberIdFromIm");function z(e){return U(e)&&e.members}c(z,"getMemberIdsFromMpim");function j(e){const h={};if(!Y(e))return L(e)?(h.should_reload=e.should_reload,h.client_min_version=e.client_min_version,h):(X(e)&&(h.should_reauth=e.should_reauth),h);const g=e,{team:d,links:V,subteams:M,self:_,prefs:m,app_homes:B,starred:x,read_only_channels:H,thread_only_channels:S,paid_features:w,emoji_cache_ts:$,commands_cache_ts:k,app_commands_cache_ts:G,can_manage_shared_channels:q,accept_tos_url:N,should_reload:t,client_min_version:n,is_europe:a,channels_priority:o,unchanged_channel_ids:i,...s}=g,f=Object(P.a)({teamId:d.id,userId:_.id});Object(v.a)({data:e,tracer:f,fetchType:R.b.ClientBootGeneric});let l,D,I;if(Z(e)&&(l=e.account_types,D=e.workspaces,I=e.default_workspace),e.auth_min_last_fetched&&E.a.maybeSetMinLastFetchedAuthTimestamp(e.auth_min_last_fetched),e.can_access_client_v2&&Object(C.v)(W.a,e.can_access_client_v2),!Object(u.a)(t)&&(h.should_reload=t,h.client_min_version=n,t))return h;const A={...d.prefs,can_user_manage_shared_channels:q};var tt;const nt=[...(tt=M==null?void 0:M.self)!==null&&tt!==void 0?tt:[]],et=J({...s,teamId:d.id,starred:x,channels_priority:o,read_only_channels:H,thread_only_channels:S}),at=(g.ims||[]).map(Q=>T(Q)).filter(Q=>!!Q),ot=O(g.mpims),it=at.concat(ot).filter((Q,rt,st)=>st.indexOf(Q)===rt);return{...h,selfData:_,teamData:d,teamPrefsData:A,userPrefsData:m,channelsData:et,starredChannels:x,readOnlyChannels:H,threadOnlyChannels:S,appHomesData:B,membersToFetch:it,userGroupMembershipData:nt,paidFeatures:w,emojiBootData:{cacheTs:$},slashCommandsBootData:{cacheTs:k},appCommandsCacheTs:G,acceptTosUrl:N,isEurope:a,domainsBootData:V,accountTypes:l,workspaces:D,defaultWorkspace:I,channelsPriorityData:o,unchangedChannelIds:i}}c(j,"processClientBootData");function J(e){const h=[...e.channels||[],...e.ims||[],...e.mpims||[]],g=[];if(h.length){const{is_open:d=[]}=e,V=new Set(d),M=h.length;for(let _=0;_<M;_++){const m=h[_],B=m.id;m.is_member=!0,delete m.latest,delete m.last_read,(y(h[_])||U(h[_]))&&(m.is_open=V.has(B)),g.push(m)}}return g}c(J,"hydrateChannelData");function O(e){return e?Object(b.a)(e,(h,g)=>{if(!g)return h;const d=z(g)||[];return h.push(...d),h},[]):[]}c(O,"getMpimMembersFromMpims");function Y(e){return!Object(u.a)(e.team)}c(Y,"isPrimaryResponse");function L(e){return!Object(u.a)(e.should_reload)}c(L,"isShouldReloadResponse");function X(e){return!Object(u.a)(e.should_reauth)}c(X,"isShouldReauthResponse");function Z(e){return!Object(u.a)(e.account_types)}c(Z,"isClientUserBootResponse");const F={processClientBootData:j,getMpimMembersFromMpims:O};Object.defineProperty(F,"processClientBootData",{get:()=>j,set:e=>{j=e}}),Object.defineProperty(F,"getMpimMembersFromMpims",{get:()=>O,set:e=>{O=e}})},cznn:function(K,p,r){"use strict";r.d(p,"a",function(){return W});var u=r("9oTK"),b=r.n(u),C=r("Lgge");function W(R){return v.apply(this,arguments)}c(W,"apiCloseBootQueue");function v(){return v=Object(u.coroutine)(function*(R){let{apiCalls:P,contextualInfo:E}=R;return C.a.all(Object.values(P)).catch(()=>{}).finally(()=>{E.bootQueue.stop()}),{apiCalls:P,contextualInfo:E}}),v.apply(this,arguments)}c(v,"_apiCloseBootQueue")},dSGR:function(K,p,r){"use strict";r.d(p,"a",function(){return u});const u="canAccessClientV2"}}]);})();
